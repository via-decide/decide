<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEDIA FORGE | Studio v1.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root {
            --studio-bg: #050505;
            --studio-panel: #0a0a0a;
            --studio-green: #00e676;
            --studio-border: #333;
            --font-mono: 'Courier New', monospace;
            --font-ui: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            background-color: var(--studio-bg);
            color: #fff;
            font-family: var(--font-mono);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .studio-container {
            width: 100%;
            max-width: 600px;
            background: var(--studio-panel);
            border: 1px solid var(--studio-border);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--studio-border);
            padding-bottom: 20px;
        }

        .title {
            font-size: 1.5rem;
            color: var(--studio-green);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reset-btn {
            background: none;
            border: none;
            color: #666;
            font-family: var(--font-mono);
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.8rem;
        }
        .reset-btn:hover { color: #fff; }

        .label {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .input-area {
            width: 100%;
            height: 200px;
            background: #000;
            border: 1px solid var(--studio-border);
            color: var(--studio-green);
            font-family: var(--font-mono);
            padding: 15px;
            border-radius: 8px;
            resize: none;
            font-size: 0.9rem;
            margin-bottom: 20px;
            box-sizing: border-box;
        }
        .input-area:focus { outline: 1px solid var(--studio-green); }

        .file-upload-box {
            border: 1px dashed var(--studio-border);
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
        }
        .file-upload-box:hover { border-color: var(--studio-green); background: rgba(0, 230, 118, 0.05); }
        .file-upload-box input { display: none; }

        .action-btn {
            width: 100%;
            padding: 18px;
            background: var(--studio-green);
            color: #000;
            border: none;
            border-radius: 8px;
            font-family: var(--font-mono);
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
            margin-top: 10px;
        }
        .action-btn:active { transform: scale(0.98); opacity: 0.9; }

        .console-log {
            margin-top: 20px;
            font-size: 0.8rem;
            color: #444;
            min-height: 40px;
        }
        .console-line { margin: 4px 0; }
        .error { color: #ff3333; }
        .success { color: var(--studio-green); }

        /* SCRIPT OUTPUT */
        .script-output {
            display: none;
            margin-top: 30px;
            border-top: 1px solid var(--studio-border);
            padding-top: 20px;
        }
        .script-output.visible { display: block; }
        
        .script-node {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--studio-green);
        }
        .speaker { color: var(--studio-green); font-weight: bold; font-size: 0.8rem; margin-bottom: 5px; }
        .dialogue { color: #ddd; line-height: 1.5; }

    </style>
</head>
<body>

<div class="studio-container">
    <div class="header">
        <div class="title">‚öóÔ∏è MEDIA FORGE</div>
        <button class="reset-btn" onclick="location.reload()">[RESET]</button>
    </div>

    <div class="label">IMPORT SOURCE (PDF)</div>
    <label class="file-upload-box">
        <input type="file" id="pdf-upload" accept="application/pdf" onchange="handlePDF(this)">
        <span style="color:#888; font-size:0.8rem;">üìÇ CLICK TO UPLOAD 'DECIDE_JOURNEY.PDF'</span>
    </label>

    <div class="label">RAW DATA (JSON PAYLOAD)</div>
    <textarea id="json-input" class="input-area" placeholder="Paste JSON here or upload PDF..."></textarea>

    <div class="label">SESSION ID (OPTIONAL)</div>
    <input type="text" id="session-id" placeholder="SES_..." style="width:100%; padding:12px; background:#000; border:1px solid #333; color:#fff; border-radius:8px; margin-bottom:20px; box-sizing:border-box;">

    <button class="action-btn" onclick="generateScript()">GENERATE NOTEBOOK SCRIPT üìÑ</button>

    <div id="console" class="console-log">
        <div class="console-line">> System Ready.</div>
    </div>

    <div id="output" class="script-output"></div>
</div>

<script>
    // üß† STUDIO CORE LOGIC
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    function log(msg, type='') {
        const c = document.getElementById('console');
        c.innerHTML += `<div class="console-line ${type}">> ${msg}</div>`;
        c.scrollTop = c.scrollHeight;
    }

    async function handlePDF(input) {
        if (input.files.length === 0) return;
        const file = input.files[0];
        log(`Reading ${file.name}...`);

        const reader = new FileReader();
        reader.onload = async function() {
            const typedarray = new Uint8Array(this.result);
            try {
                const pdf = await pdfjsLib.getDocument(typedarray).promise;
                let fullText = "";
                
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(" ");
                    fullText += pageText + "\n";
                }
                
                parsePDFText(fullText);
            } catch (e) {
                log("PDF Error: " + e.message, 'error');
            }
        };
        reader.readAsArrayBuffer(file);
    }

    function parsePDFText(text) {
        log("Parsing PDF Nodes...");
        // Regex to find [NODE XX] TITLE ... Body
        // This is a simplified parser based on your PDF structure
        const nodes = [];
        const parts = text.split(/\[NODE \d+\]/);
        
        // Skip preamble
        for(let i=1; i<parts.length; i++) {
            let chunk = parts[i].trim();
            // Split title (first few words usually caps) from body
            // Heuristic: First chunk of text before newline or period
            let title = "UNKNOWN TOPIC";
            let summary = chunk;
            
            // Clean up PDF artifacts
            summary = summary.replace(/\/g, ""); 
            
            // Guess title (first 3-5 words)
            const words = summary.split(' ');
            if(words.length > 0) {
                title = words.slice(0, 4).join(" ").toUpperCase(); // Approximate title
            }

            nodes.push({ title: title, summary: summary });
        }

        if(nodes.length > 0) {
            document.getElementById('json-input').value = JSON.stringify(nodes, null, 2);
            log(`Success: Extracted ${nodes.length} Nodes.`, 'success');
        } else {
            log("No Nodes found in text stream.", 'error');
        }
    }

    function generateScript() {
        const input = document.getElementById('json-input').value;
        const output = document.getElementById('output');
        output.innerHTML = "";
        
        try {
            if(!input) throw new Error("Input is empty.");
            const data = JSON.parse(input);
            
            if(!Array.isArray(data)) throw new Error("Data must be an array.");

            log("Generating Script...", 'success');
            output.classList.add('visible');

            // HOST INTRO
            addScriptLine("HOST", "Welcome back to the forge. Today we're analyzing a new data path.");
            
            data.forEach((node, i) => {
                // AI LOGIC TO MAKE IT SOUND LIKE A SCRIPT
                addScriptLine("AI ASSISTANT", `Node ${i+1} identified: ${node.title}.`);
                addScriptLine("HOST", "Break it down for me.");
                addScriptLine("AI ASSISTANT", node.summary.substring(0, 200) + "...");
                addScriptLine("HOST", "Interesting. What connects to this?");
            });

            addScriptLine("HOST", "End of stream. Archive this session.");

        } catch(e) {
            log(e.message, 'error');
        }
    }

    function addScriptLine(speaker, text) {
        const div = document.createElement('div');
        div.className = 'script-node';
        div.innerHTML = `<div class="speaker">${speaker}</div><div class="dialogue">${text}</div>`;
        document.getElementById('output').appendChild(div);
    }
</script>

</body>
</html>
